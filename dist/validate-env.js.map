{"version":3,"file":"validate-env.js","sources":["../src/core/validate-env.ts"],"sourcesContent":["/**\n * validate-env.ts\n *\n * Validates the env and prNR inputs for the GitHub Action\n *\n * This module handles validation of the deployment environment, with support for:\n * - Pull Request preview deployments (prNR input creates pr-{number} tag)\n * - Standard environment deployments (ci, tr, fprd, fqa, next)\n *\n * Deployment logic:\n * - If prNR is provided: Uses 'ci' environment with tag 'pr-{number}'\n * - Otherwise: Validates env is in allowed list and requires tag input\n *\n * Used as part of GitHub Action workflows to ensure the correct environment is targeted\n * for the application deployment.\n */\n\nimport * as core from \"@actions/core\";\n\n/** Prefix used for PR preview deployments */\nconst PR_TAG_PREFIX = \"pr-\";\n\n/**\n * Validates the environment and optional PR number inputs\n *\n * Validation logic:\n * 1. If prNR provided: Sets environment to 'ci' and creates tag as 'pr-{number}'\n * 2. Otherwise: Validates 'env' input is one of allowed values (ci, tr, fprd, fqa, next)\n * 3. Validates 'tag' input is provided for non-PR deployments\n *\n * Sets GitHub Action outputs:\n * - `env`: The validated deployment environment\n * - `tag`: The deployment tag (either 'pr-{number}' or user-provided tag)\n *\n * Fails the GitHub Action if validation fails\n *\n * @throws Does not throw, but calls core.setFailed() on validation errors\n * @example\n * // PR deployment\n * // With inputs: prNR=123\n * validateEnv(); // Sets env='ci', tag='pr-123'\n *\n * @example\n * // Standard deployment\n * // With inputs: env='fprd', tag='v1.0.0'\n * validateEnv(); // Sets env='fprd', tag='v1.0.0'\n */\nexport function validateEnv(): void {\n  const prNR = core.getInput(\"prNR\");\n  const env = core.getInput(\"env\");\n  const tag = core.getInput(\"tag\");\n\n  // If prNR is provided, set the tag output accordingly\n  if (prNR) {\n    core.info(`prNR provided: ${prNR}`);\n    core.setOutput(\"tag\", `${PR_TAG_PREFIX}${prNR}`);\n    core.setOutput(\"env\", \"ci\");\n    return;\n  }\n\n  // Validate that the env input is provided\n  if (!env) {\n    core.setFailed(\"Input 'env' is required.\");\n    return;\n  }\n\n  // Validate that the env input is one of the allowed values\n  const allowedEnvs = [\"ci\", \"tr\", \"fprd\", \"fqa\", \"next\"];\n  if (!allowedEnvs.includes(env)) {\n    core.setFailed(`Input 'env' must be one of the following values: ${allowedEnvs.join(\", \")}.`);\n    return;\n  }\n\n  // Validate that the tag input is provided\n  if (!tag) {\n    core.setFailed(\"Input 'tag' is required.\");\n    return;\n  }\n\n  // If all validations pass\n  core.info(\"Environment validation passed.\");\n  core.setOutput(\"env\", env);\n  core.setOutput(\"tag\", tag);\n}\n\n// Execute if called directly\nif (require.main === module) {\n  validateEnv();\n}\n"],"names":["core.getInput","core.info","core.setOutput","core.setFailed"],"mappings":";AAoBA,MAAM,gBAAgB;AA2Bf,SAAS,cAAoB;AAClC,QAAM,OAAOA,YAAAA,SAAc,MAAM;AACjC,QAAM,MAAMA,YAAAA,SAAc,KAAK;AAC/B,QAAM,MAAMA,YAAAA,SAAc,KAAK;AAG/B,MAAI,MAAM;AACRC,gBAAAA,KAAU,kBAAkB,IAAI,EAAE;AAClCC,gBAAAA,UAAe,OAAO,GAAG,aAAa,GAAG,IAAI,EAAE;AAC/CA,gBAAAA,UAAe,OAAO,IAAI;AAC1B;AAAA,EACF;AAGA,MAAI,CAAC,KAAK;AACRC,gBAAAA,UAAe,0BAA0B;AACzC;AAAA,EACF;AAGA,QAAM,cAAc,CAAC,MAAM,MAAM,QAAQ,OAAO,MAAM;AACtD,MAAI,CAAC,YAAY,SAAS,GAAG,GAAG;AAC9BA,gBAAAA,UAAe,oDAAoD,YAAY,KAAK,IAAI,CAAC,GAAG;AAC5F;AAAA,EACF;AAGA,MAAI,CAAC,KAAK;AACRA,gBAAAA,UAAe,0BAA0B;AACzC;AAAA,EACF;AAGAF,cAAAA,KAAU,gCAAgC;AAC1CC,cAAAA,UAAe,OAAO,GAAG;AACzBA,cAAAA,UAAe,OAAO,GAAG;AAC3B;AAGA,IAAI,QAAQ,SAAS,QAAQ;AAC3B,cAAA;AACF;"}